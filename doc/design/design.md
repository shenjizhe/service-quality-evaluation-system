# 客户服务质量检测 - 设计文档

## 流程图
系统由以下4个阶段组成
- 客服信息获取阶段
  
      客服在语音通话结束后，七鱼系统推送通话记录给系统

- 语音识别阶段
  
      系统提交录音文件给阿里云语音识别系统，
      阿里云将在六小时返回文本信息给系统
  
- 关键词识别阶段

      系统经过关键词识别，找到符合检查条件的通话记录

- 通话异常记录阶段

      记录异常记录到系统中，供二次人为核实通话异常

![img.png](../images/workflow.png)

## 数据库设计
数据库由下边留张表组成
- customer_service_record
  
      客户服务记录表，记录了客户服务的信息，包括客户信息，客服信息，通话的录音地址
  
- sound_to_text_task

      声音识别任务表，提交到阿里平台的任务记录，由于识别是一个需要花费较长时间（6小时内）
      才可以返回结果的延时计算，所以需要记录来检查任务的执行状态

- sentence_result

      识别的文本结果表，包含了语音文件的识别文本，还包含了一些其他的对话信息

- keyword_map

      关键词字典表，记录了要作为检查的关键词

- keyword_check_record、

      关键词检查结果，包括了异常的记录

![img.png](../images/db-er.png)

## 系统构件图
系统包括以下组件：

- 七鱼呼叫系统

      用于提供客服呼叫系统的功能，并提供推送客服信息的功能
  
- 阿里智能语音识别系统
  
      提供了语音识别服务

- 客服接入服务
      
      作为七鱼系统的接入服务，接受并记录客服信息

- 录音识别接入服务
    
      作为阿里语音识别服务接入服务，上传录音文件，并等待识别结果的推送
  
- 关键词检查服务

      检查客服文本信息的关键词，查找符合条件的记录，并记录

- 客服质量检测服务

      读取记录，呈现给用户

![img.png](../images/structure.png)

## 接口设计

### 1.七鱼客服完成 web_hook API

[post] http://<domain_name>/api/ivr/crminfo?checksum=XXXXXXXXXXXXXXX




